# --------------------------------------------------------------------------------------
# 步骤 1: 使用 NCA Toolkit 的公共镜像作为基础镜像
FROM stephengpope/no-code-architects-toolkit:latest

# --------------------------------------------------------------------------------------
# ❗ 关键修复：强制切换到 root 用户来执行系统级的安装命令
USER root

# 步骤 2: 安装字体所需工具并创建字体目录
# fontconfig 包用于管理和刷新字体缓存
RUN apt-get update && apt-get install -y fontconfig

# 创建标准字体目录
RUN mkdir -p /usr/share/fonts/custom

# --------------------------------------------------------------------------------------
# 步骤 3: 复制并安装您的自定义字体
COPY NotoSansSC-Regular.ttf /usr/share/fonts/custom/

# --------------------------------------------------------------------------------------
# 步骤 4: 刷新字体缓存，使容器系统识别新字体
RUN fc-cache -f -v

# --------------------------------------------------------------------------------------
# 步骤 5: (可选) 如果基础镜像需要非 root 用户运行，请切换回默认用户
# 这一步依赖于原镜像的配置，通常在 Cloud Run 部署时非 root 更安全。
# 如果不确定，可以暂时不加，让其保持 root
# USER <原镜像的用户，例如 appuser 或 node>